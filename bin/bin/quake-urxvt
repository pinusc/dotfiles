#!/usr/bin/env bash

WMNAME="quake-tab"
WIDFILE="/tmp/quake-tabbed.wid"
wid=$(xdotool search --classname "$WMNAME")

if [[ -z "$wid" ]]; then
    wid=$(tabbed -n "$WMNAME" -d -g 900x600 )
    echo "$wid" > "$WIDFILE"
    quake-urxvt-newtab
    exit 0
fi

state="$(xprop -id "$wid" | awk -F: '/window state/{print $2;}' \
    | tr -d ' ' | tr '[:upper:]' '[:lower:]')" 

if [ "$state" = "normal" ]; then
    xdotool search --classname "$WMNAME" windowunmap
else
    xdotool search --classname "$WMNAME" windowmap
fi
